<div class="mis-pedidos-container">
    <h1>Seguimiento de mis pedidos</h1>
    <p class="subtitle">Ingres√° tu email para ver el estado de tus compras.</p>

    <div class="search-box">
        <input type="email" [(ngModel)]="email" placeholder="tu@email.com" (keyup.enter)="buscar()">
        <button class="btn-primary" (click)="buscar()" [disabled]="loading">
            {{ loading ? 'Buscando...' : 'VER MIS PEDIDOS' }}
        </button>
    </div>

    <div class="results-msg" *ngIf="searched && pedidos.length === 0">
        <p>No encontramos pedidos asociados a este email.</p>
    </div>

    <div class="pedidos-list" *ngIf="pedidos.length > 0">
        <div class="pedido-card" *ngFor="let p of pedidos" (click)="verDetalle(p)">
            <div class="card-header">
                <span class="order-num">#{{ p.numero_pedido }}</span>
                <span class="order-date">{{ p.created_at | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
            <div class="card-body">
                <div class="status-badge" [style.background-color]="getEstadoColor(p.estado)">
                    {{ p.estado | uppercase }}
                </div>
                <div class="order-total">
                    <strong>Total:</strong> ${{ p.total | number:'1.0-2' }}
                </div>
            </div>
            <div class="card-footer">
                <span>Click para ver m√°s detalles y tracking</span>
            </div>
        </div>
    </div>

    <!-- MODAL DETALLE -->
    <div class="modal-overlay" *ngIf="pedidoDetalle" (click)="cerrarDetalle()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <button class="btn-close" (click)="cerrarDetalle()">‚úï</button>
            <h2>Detalle del Pedido #{{ pedidoDetalle.numero_pedido }}</h2>

            <div class="info-section">
                <h3>Informaci√≥n de entrega</h3>
                <p>{{ pedidoDetalle.cliente_nombre }}</p>
                <p>{{ pedidoDetalle.cliente_direccion }}</p>
                <p>{{ pedidoDetalle.cliente_localidad }}, {{ pedidoDetalle.cliente_provincia }}</p>
            </div>

            <div class="info-section">
                <h3>Estado del Env√≠o</h3>
                <div class="shipment-status" *ngIf="pedidoDetalle.envio">
                    <p><strong>Transportista:</strong> {{ pedidoDetalle.envio.transportista }}</p>
                    <p><strong>Nro de Gu√≠a:</strong> {{ pedidoDetalle.envio.numero_guia || 'Pendiente' }}</p>

                    <div class="tracking-actions" *ngIf="pedidoDetalle.envio.numero_guia">
                        <a *ngIf="getTrackingUrl(pedidoDetalle.envio.transportista, pedidoDetalle.envio.numero_guia) as url"
                            [href]="url" target="_blank" class="btn-track">
                            üöö Seguir env√≠o en {{ pedidoDetalle.envio.transportista }}
                        </a>
                    </div>

                    <div class="tracking-history" *ngIf="pedidoDetalle.envio.updates?.length > 0">
                        <h4>Historial de movimientos:</h4>
                        <div class="tracking-item" *ngFor="let up of pedidoDetalle.envio.updates">
                            <span class="t-date">{{ up.fecha | date:'dd/MM HH:mm' }}</span>
                            <span class="t-status">{{ up.estado }}</span>
                            <p class="t-desc">{{ up.descripcion }}</p>
                        </div>
                    </div>
                    <p class="no-updates" *ngIf="pedidoDetalle.envio.updates?.length === 0">
                        A√∫n no hay actualizaciones de seguimiento.
                    </p>
                </div>
            </div>

            <div class="info-section">
                <h3>Productos</h3>
                <div class="items-mini">
                    <div class="item-mini" *ngFor="let item of pedidoDetalle.items">
                        {{ item.cantidad }}x {{ item.producto_nombre }} ({{ item.talle_nombre }})
                        <span>${{ item.subtotal | number:'1.0-0' }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>