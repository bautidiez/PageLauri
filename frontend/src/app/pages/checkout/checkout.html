<div class="checkout-page">
  <div class="container">
    <h1>Finalizar Compra</h1>

    <div class="checkout-content">
      <div class="checkout-form">
        <h2>Datos de Entrega</h2>
        <form (ngSubmit)="procesarPedido()">
          <div class="form-group">
            <label>Nombre completo *</label>
            <input type="text" [(ngModel)]="cliente.nombre" name="nombre" required>
          </div>

          <div class="form-group">
            <label>Email *</label>
            <input type="email" [(ngModel)]="cliente.email" name="email" required>
          </div>

          <div class="form-group">
            <label>Teléfono</label>
            <input type="tel" [(ngModel)]="cliente.telefono" name="telefono">
          </div>

          <div class="form-group">
            <label>Dirección *</label>
            <input type="text" [(ngModel)]="cliente.direccion" name="direccion" required>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Código Postal *</label>
              <input type="text" [(ngModel)]="cliente.codigo_postal" name="codigo_postal"
                (input)="onCodigoPostalChange()" required>
            </div>

            <div class="form-group">
              <label>Localidad *</label>
              <input type="text" [(ngModel)]="cliente.localidad" name="localidad" required>
            </div>
          </div>

          <div class="form-group">
            <label>Provincia *</label>
            <input type="text" [(ngModel)]="cliente.provincia" name="provincia" required>
          </div>

          <div class="envio-options">
            <label class="envio-option" [class.selected]="metodoEnvio === 'retiro'">
              <input type="radio" name="metodoEnvio" value="retiro" [(ngModel)]="metodoEnvio"
                (change)="calcularEnvio()">
              <div class="envio-info">
                <span class="envio-nombre">Retiro en local</span>
                <span class="envio-costo">Gratis</span>
              </div>
            </label>

            <ng-container *ngIf="cliente.codigo_postal && cliente.codigo_postal.length >= 4">
              <label class="envio-option" *ngFor="let metodo of ['correo_argentino', 'andreani', 'tienda_nube']"
                [class.selected]="metodoEnvio === metodo">
                <input type="radio" name="metodoEnvio" [value]="metodo" [(ngModel)]="metodoEnvio"
                  (change)="calcularEnvio()">
                <div class="envio-info">
                  <span class="envio-nombre">{{ getMetodoEnvioNombre(metodo) }}</span>
                  <span class="envio-costo" *ngIf="costosEnvio[metodo]">
                    ${{ costosEnvio[metodo] | number:'1.0-0' }}
                  </span>
                  <span class="envio-costo" *ngIf="!costosEnvio[metodo] && metodoEnvio === metodo && costoEnvio > 0">
                    ${{ costoEnvio | number:'1.0-0' }}
                  </span>
                </div>
              </label>
            </ng-container>
          </div>

          <h2>Método de Pago</h2>
          <div class="payment-methods">
            <label *ngFor="let metodo of metodosPago" class="payment-option">
              <input type="radio" name="metodoPago" [value]="metodo.id" [(ngModel)]="metodoPagoSeleccionado">
              <span>{{ metodo.descripcion }}</span>
            </label>
          </div>

          <button type="submit" class="btn btn-primary btn-large" [disabled]="procesando">
            {{ procesando ? 'Procesando...' : 'Confirmar Pedido' }}
          </button>
        </form>
      </div>

      <div class="checkout-summary">
        <h2>Resumen del Pedido</h2>
        <div class="summary-items">
          <div class="summary-item" *ngFor="let item of items">
            <div class="item-info">
              <p>{{ item.producto.nombre }}</p>
              <small>Talle: {{ item.talle.nombre }} x {{ item.cantidad }}</small>
            </div>
            <div class="item-price">
              ${{ (item.precio_unitario * item.cantidad) | number:'1.0-0' }}
            </div>
          </div>
        </div>

        <div class="summary-totals">
          <div class="summary-row">
            <span>Subtotal:</span>
            <span>${{ subtotal | number:'1.0-0' }}</span>
          </div>
          <div class="summary-row">
            <span>Envío:</span>
            <span>${{ costoEnvio | number:'1.0-0' }}</span>
          </div>
          <div class="summary-row total">
            <span>Total:</span>
            <span>${{ total | number:'1.0-0' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>